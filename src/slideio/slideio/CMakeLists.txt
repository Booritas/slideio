CONAN_MAIN()
set(LIBRARY_NAME ${SLIEIO_LIB_NAME})

set(SOURCE_FILES 
   ${SOURCE_FILES}
   ${CMAKE_CURRENT_SOURCE_DIR}/imagedrivermanager.hpp
   ${CMAKE_CURRENT_SOURCE_DIR}/imagedrivermanager.cpp
   ${CMAKE_CURRENT_SOURCE_DIR}/logs.cpp
   ${CMAKE_CURRENT_SOURCE_DIR}/slideio.cpp
   ${CMAKE_CURRENT_SOURCE_DIR}/slideio.hpp
   ${CMAKE_CURRENT_SOURCE_DIR}/slideio_def.hpp
   ${CMAKE_CURRENT_SOURCE_DIR}/slide.hpp
   ${CMAKE_CURRENT_SOURCE_DIR}/slide.cpp
   ${CMAKE_CURRENT_SOURCE_DIR}/scene.hpp
   ${CMAKE_CURRENT_SOURCE_DIR}/scene.cpp
   )


add_library(${LIBRARY_NAME} SHARED ${SOURCE_FILES})

SOURCE_GROUP_BY_FOLDER(SOURCE_FILES)

target_link_libraries(${LIBRARY_NAME} 
   ${CORE_LIB_NAME}
   ${IMAGETOOLS_LIB_NAME}
   ${GDAL_DRIVER_NAME}
   ${SVS_DRIVER_NAME}
   ${AFI_DRIVER_NAME}
   ${CZI_DRIVER_NAME}
   ${DCM_DRIVER_NAME}
   ${SCN_DRIVER_NAME}
   ${ZVI_DRIVER_NAME}
   ${NDPI_DRIVER_NAME}
   )

IF(WIN32)
   target_link_libraries(${LIBRARY_NAME} Shlwapi)
   set_target_properties(${LIBRARY_NAME} PROPERTIES LINK_FLAGS "/ignore:4099")
   target_compile_definitions(${LIBRARY_NAME} PRIVATE SLIDEIO_API _CRT_SECURE_NO_WARNINGS)
ENDIF(WIN32)

set_target_properties(${LIBRARY_NAME} PROPERTIES LINKER_LANGUAGE CXX)

CONAN_CONFIGURE(${LIBRARY_NAME})


# Copy glog library
find_file(GLOG_LIB_RELEASE NAMES "${CONAN_PKG_LIBS_GLOG_RELEASE}.dll" "${CONAN_PKG_LIBS_GLOG_RELEASE}.so" PATHS ${CONAN_BIN_DIRS_GLOG_RELEASE})
find_file(GLOG_LIB_DEBUG NAMES "${CONAN_PKG_LIBS_GLOG_DEBUG}.dll" "${CONAN_PKG_LIBS_GLOG_DEBUG}.so" PATHS ${CONAN_BIN_DIRS_GLOG_DEBUG})

add_custom_command(TARGET ${SLIEIO_LIB_NAME} POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E copy 
    $<$<CONFIG:Debug>:${GLOG_LIB_DEBUG}>$<$<CONFIG:Release>:${GLOG_LIB_RELEASE}>
    $<TARGET_FILE_DIR:${LIBRARY_NAME}>
)

# Copy gflags library
find_file(GFLAGS_LIB_RELEASE NAMES "${CONAN_PKG_LIBS_GFLAGS_RELEASE}.dll" "${CONAN_PKG_LIBS_GFLAGS_RELEASE}.so" PATHS ${CONAN_BIN_DIRS_GFLAGS_RELEASE})
find_file(GFLAGS_LIB_DEBUG NAMES "${CONAN_PKG_LIBS_GFLAGS_DEBUG}.dll" "${CONAN_PKG_LIBS_GFLAGS_DEBUG}.so" PATHS ${CONAN_BIN_DIRS_GFLAGS_DEBUG})

add_custom_command(TARGET ${SLIEIO_LIB_NAME} POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E copy 
    $<$<CONFIG:Debug>:${GFLAGS_LIB_DEBUG}>$<$<CONFIG:Release>:${GFLAGS_LIB_RELEASE}>
    $<TARGET_FILE_DIR:${LIBRARY_NAME}>
)