name: Linux build slideio wheels

on: [workflow_dispatch]
jobs:
  build-linux:
    runs-on: ubuntu-20.04
    container:
      image: booritas/slideio-manylinux_2_28_x86_64:2.7.0
      env:
        CONAN_REVISIONS_ENABLED: 1
        CONAN_DISABLE_CHECK_COMPILER: 1
    steps:

    - name: checkout
      uses: actions/checkout@v4
      with:
        submodules: 'true'

    - name: list conan packages
      run: ls -la ~/.conan2/p

    - name: list conan packages root
      run: ls -la /root/.conan2/p

    - name: list available python versions
      run: ls -la /opt/python
    
    - name: Install conan dependencies
      run: |
        python3 install.py -a conan -c release
   
    - name: build python packages
      working-directory: ./src/py-bind
      run: bash ./build-wheels-linux.sh

    - name: Archive python packagess
      uses: actions/upload-artifact@v4
      with:
        name: python-dist
        path: |
          ./src/py-bind/wheelhouse
